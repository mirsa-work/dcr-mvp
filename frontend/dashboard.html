<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>DCR Dashboard (stub)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
</head>

<body class="p-3">
    <div id="loginBox">
        <h3>Login</h3>
        <input id="user" placeholder="username"><br>
        <input id="pass" placeholder="password" type="password"><br>
        <button id="loginBtn" class="btn btn-primary">Login</button>
        <div id="err" class="text-danger mt-2"></div>
    </div>

    <div id="mainBox" style="display:none;">
        <h3>DCRs (branch 1)</h3>
        <button id="refresh" class="btn btn-secondary btn-sm">Refresh</button>
        <button id="newBtn" class="btn btn-success btn-sm">New (quick)</button>
        <table class="table mt-2" id="tbl">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>DCR #</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <script>
        let token = '';

        $('#loginBtn').on('click', () => {
            $.post('/api/login', { username: $('#user').val(), password: $('#pass').val() })
                .done(r => { token = r.token; $('#loginBox').hide(); $('#mainBox').show(); load(); })
                .fail(x => $('#err').text(x.responseJSON?.error || 'fail'));
        });

        function load() {
            $.ajax({ url: '/api/branches/1/dcr', headers: { Authorization: `Bearer ${token}` } })
                .done(rows => {
                    const body = rows.map(r => `<tr><td>${r.dcr_date}</td><td>${r.dcr_number}</td><td>${r.status}</td></tr>`).join('');
                    $('#tbl tbody').html(body);
                });
        }
        $('#refresh').on('click', load);

        $('#newBtn').on('click', () => {
            const sample = { date: new Date().toISOString().slice(0, 10), purchase: 10, daily_consumption: 5, closing_stock: 5 };
            $.ajax({ method: 'POST', url: '/api/branches/1/dcr', headers: { Authorization: `Bearer ${token}` }, data: JSON.stringify(sample), contentType: 'application/json' })
                .done(() => { alert('Saved'); load(); })
                .fail(x => alert(JSON.stringify(x.responseJSON)));
        });
    </script>
</body>

</html>